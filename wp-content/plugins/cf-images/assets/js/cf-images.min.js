(()=>{"use strict";let e=null;const t=e=>{e.preventDefault();const t=document.getElementById(e.currentTarget.getAttribute("data-target"));null!=t&&a(t)?o(t):s(t)};window.cfToggleModal=t;const a=e=>e.hasAttribute("open")&&"false"!==e.getAttribute("open"),s=t=>{n()&&document.documentElement.style.setProperty("--scrollbar-width",`${i()}px`),setTimeout((()=>{e=t}),10),t.setAttribute("open",!0)},o=t=>{e=null,document.documentElement.style.removeProperty("--scrollbar-width"),setTimeout((()=>{t.removeAttribute("open")}),10)};document.addEventListener("click",(t=>{null!==e&&(e.querySelector("article").contains(t.target)||o(e))})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&null!==e&&o(e)}));const i=()=>{const e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);const t=document.createElement("div");e.appendChild(t);const a=e.offsetWidth-t.offsetWidth;return e.parentNode.removeChild(e),a},n=()=>document.body.scrollHeight>screen.height,c=function(e,t="success"){const a=jQuery("#cf-images-ajax-notice");a.addClass("notice-"+t),a.find("p").html(e),a.slideDown().delay(5e3).queue((function(){jQuery(this).slideUp("slow",(function(){jQuery(this).removeClass("notice-"+t),jQuery(this).find("p").html("")})),jQuery.dequeue(this)}))},r=function(e,t={}){return t={_ajax_nonce:CFImages.nonce,action:e,data:t},new Promise(((e,a)=>{jQuery.ajax({url:ajaxurl,type:"POST",data:t,success(t){e(t)},error(e){a(e)}})}))};var l;(l=jQuery)("#image_ai").on("change",(e=>l(".cf-images-ai-settings").toggle(e.target.checked))),l("#image-ai-disconnect").on("click",(function(e){e.preventDefault(),r("cf_images_ai_disconnect").then((()=>window.location.search+="&saved=true")).catch(window.console.log)})),l("#image-ai-login").on("click",(function(e){e.preventDefault();const{login:t,savingChanges:a}=CFImages.strings;l(this).attr("aria-busy",!0).html(a);const s={email:l("#cf-ai-email-address").val(),password:l("#cf-ai-password").val()};r("cf_images_ai_login",s).then((e=>{l(this).attr("aria-busy",!1).html(t),e.success||void 0===e.data?window.location.search+="&login=true":c(e.data,"error")})).catch(window.console.log)})),function(e){const a={settings:"cf_images_save_settings",setup:"cf_images_do_setup"},s={cf_images_offload_image:".cf-images-offload",cf_images_skip_image:".cf-images-skip",cf_images_undo_image:".cf-images-undo",cf_images_delete_image:".cf-images-delete",cf_images_restore_image:".cf-images-restore",cf_images_ai_caption:".cf-images-ai-alt"};e(document).ready((function(){setTimeout((()=>e("#cf-images-notice").slideUp("slow")),5e3)})),e("#save-settings").on("click",(function(t){t.preventDefault();const s=e("form#cf-images-form"),o=a[s.data("type")];if(void 0===o)return;const{inProgress:i,saveChange:n}=CFImages.strings;e(this).attr("aria-busy",!0).html(i+"..."),r(o,s.serialize()).then((t=>{if(!t.success)return e(this).attr("aria-busy",!1).html(n),void(void 0!==t.data&&c(t.data,"error"));window.location.search+="&saved=true"})).catch(window.console.log)})),e("#cf-images-upload-all").on("click",(function(t){t.preventDefault(),e(".media_page_cf-images [role=button]").attr("disabled",!0),o("upload")})),e("#cf-images-remove-all").on("click",(function(a){a.preventDefault(),t(a),e(".media_page_cf-images form#cf-images-form [role=button]").attr("disabled",!0),o("remove")})),e("#cf-images-show-modal").on("click",(function(e){e.preventDefault(),t(e)})),e("#cf-images-disconnect").on("click",(function(t){t.preventDefault();const{disconnecting:a}=CFImages.strings;e(this).attr("aria-busy",!0).html(a),r("cf_images_disconnect").then((()=>window.location.reload())).catch(window.console.log)})),e("#custom_domain").on("change",(function(t){e('input[name="custom_domain_input"]').toggleClass("hidden",!t.target.checked)}));const o=function(t,a=0,s=0,i=0){e(".cf-images-progress."+t).show(),e(".cf-images-progress."+t+" > progress").val(i),r("cf_images_bulk_process",{currentStep:a,totalSteps:s,action:t}).then((a=>{if(!a.success)return e(".cf-images-progress."+t).hide(),e(".media_page_cf-images [role=button]").attr("disabled",!1),void c(a.data,"error");i=Math.round(100/a.data.totalSteps*a.data.currentStep),e(".cf-images-progress."+t+" > progress").val(i),e(".cf-images-progress."+t+" > p > small").html(a.data.status),a.data.currentStep<a.data.totalSteps?o(t,a.data.currentStep,a.data.totalSteps,i):window.location.search+="upload"===t?"&updated=true":"&deleted=true"})).catch(window.console.log)};Object.keys(s).forEach((t=>{e(document).on("click",s[t],(function(a){a.preventDefault();const{inProgress:s,offloadError:o}=CFImages.strings,i=e(this).closest(".cf-images-status");i.html(s+'<span class="spinner is-active"></span>'),r(t,e(this).data("id")).then((e=>{if(e.success)i.html(e.data);else{const t=e.data||o;i.html(t)}})).catch(window.console.log)}))})),e(document).on("click","#hide-the-sidebar",(()=>{r("cf_images_hide_sidebar").catch(window.console.log),e(".cf-images-sidebar").slideUp("slow",(function(){e(this).remove()}))}))}(jQuery)})();
//# sourceMappingURL=cf-images.min.js.map